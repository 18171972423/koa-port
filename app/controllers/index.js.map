{"version":3,"sources":["../../src/controllers/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Admin from '../prototype/admin';\nimport adminModel from '../models/iphone';\nimport formidable from 'formidable';\n\nclass SaveIphone extends Admin {\n    constructor(){\n        super()\n        this.saveIphone = this.saveIphone.bind(this)\n    }\n    //获取验证码\n    async getCode(ctx,next){\n        try{\n            const {phone} = ctx.query;\n            console.log(ctx.session)\n            if(!phone){\n                ctx.body = {\n                    status:0,\n                    message:'入参异常'\n                }\n                return true\n            }\n            const {_phoneCode} = ctx.session;\n            const nowTime = Date.now();\n            if(_phoneCode &&   nowTime - _phoneCode.time < 12000){\n                ctx.body = {\n                    status:0,\n                    message:'12秒后重新发送'\n                }\n                return true\n            }\n            const _code = ('000000'+parseInt(Math.random()*1000000)).substr(-6);\n            let key = `${Date.now()}${phone}`;\n            ctx.session._phoneCode = {\n                key,\n                time:Date.now(),\n                code:_code\n            }\n\n            ctx.body = {\n                status:1,\n                message:'发送成功',\n                code:_code\n            }\n\n        }catch(err){\n            console.log(err)\n        }\n    }\n    //验证验证码\n    async checkCode(ctx,next){\n        try{\n            const {code} = ctx.query\n            const {_phoneCode} = ctx.session;\n            if(_phoneCode){\n                if(Date.now() - _phoneCode.time > 300000){//5分钟失效\n                    ctx.body = {\n                        status:0,\n                        message:'验证码失效'\n                    }\n                    return true;\n                }\n                const sessionCode = _phoneCode.code;\n                if(sessionCode == code){\n                    // ctx.session._phoneCode = null;\n                    ctx.body = {\n                        status:1,\n                        message:'验证成功'\n                    }\n                    return true;\n                }\n            }\n            ctx.body = {\n                status:0,\n                message:'验证码不正确'\n            }\n        }catch(err){\n\n        }\n    }\n    async file(ctx,next){\n        try{\n            const form = new formidable.IncomingForm();\n            \n            \n        }catch(err){\n\n        }\n    }\n    async saveIphone(ctx,next){\n        try{\n            \n            const {iphone} = ctx.query;\n            const data = await adminModel.find({iphone});\n                \n            if(data.length == 0){\n                const newTel = {\n                    iphone\n                }\n                await adminModel.create(newTel)\n                ctx.body = {\n                    code:200,\n                    message:'手机号添加成功'\n                };\n            }else{\n                ctx.body = {\n                    code:400,\n                    message:'手机号已添加过'\n                }\n            }\n            \n        }catch(err){\n            console.log(err)\n        }\n        \n    }\n    async callIphone(ctx,next){\n        try{\n            const data = await adminModel.find(ctx.query);\n            if(data.length > 0){\n                ctx.body = data;\n            }else{\n                ctx.body = {\n                    code:400,\n                    message:'无查询数据'\n                }\n            }\n\n        }catch(err){\n            console.log(err)\n        }\n        \n    }\n    async delIphone(ctx,next){\n        try{\n            const findData = await adminModel.find(ctx.query);\n            if(findData.length == 0){\n                ctx.body = {\n                        code:300,\n                        message:'删除失败'\n                    }\n                return;\n            }\n            const data = await adminModel.remove(ctx.query,(err,data) => {\n                if(err){\n                    ctx.body = {\n                        code:400,\n                        message:'异常',\n                        data:err\n                    }\n                    return\n                }else{\n                    console.log(data)\n                    ctx.body = {\n                        code:200,\n                        message:'删除成功'\n                    }\n                }\n            });\n        }catch(error){\n            console.log(error)\n        }\n        \n        \n        \n    }\n}\n\n\nexport default new SaveIphone();\n\n"]}